<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ru.relex.hotelteam.db.mapper.IUserMapper">

  <resultMap id="userMap" type="User">
    <id property="id" column="user_id"/>
    <result property="firstName" column="first_name"/>
    <result property="lastName" column="last_name"/>
    <result property="middleName" column="middle_name"/>
    <result property="birthDate" column="birth_date"/>
    <result property="authority" column="authority_id"/>
  </resultMap>

  <delete id="deleteUser">
    DELETE
    FROM inprog.users
    WHERE user_id = #{id}
  </delete>

  <select id="getUserById" resultMap="userMap">
    SELECT user_id,
           first_name,
           last_name,
           middle_name,
           email,
           birth_date,
           authority_id,
           login,
           password

    FROM inprog.users
    WHERE user_id = #{id}
  </select>

  <select id="listUsers" resultMap="userMap">
    SELECT user_id,
           first_name,
           last_name,
           middle_name,
           email,
           birth_date,
           authority_id,
           login

    FROM inprog.users
  </select>

  <update id="updateUser" parameterType="User">
    UPDATE inprog.users
    <set>
      <if test="firstName != null">first_name = #{firstName},</if>
      <if test="lastName != null">last_name = #{lastName},</if>
      <if test="middleName != null">middle_name = #{middleName},</if>
      <if test="email != null">email = #{email},</if>
      <if test="birthDate != null">birth_date = #{birthDate}</if>
    </set>

    WHERE user_id = #{id}
  </update>

  <update id="updateUserSecurityInfo" parameterType="User">
    UPDATE inprog.users
    <set>
      <if test="login != null">login = #{login},</if>
      <if test="email != null">email = #{email},</if>
      <if test="password != null">password = #{password}</if>
    </set>

    WHERE user_id = #{id}
  </update>

  <select id="createUser" resultType="User">
    INSERT INTO inprog.users(authority_id, first_name, last_name, login,
                             password, middle_name, email, birth_date)
    VALUES (#{authority}, #{firstName}, #{lastName}, #{login}, #{password}, #{middleName}, #{email},
            #{birthDate}) RETURNING user_id as id,
                          first_name,
                          last_name,
                          middle_name,
                          authority_id as authority,
                          login,
                          email,
                          birth_date as birthDate
  </select>
</mapper>